@model IEnumerable<MapRover.Models.Airport>
<script src="https://maps.googleapis.com/maps/api/js?sensor=false"></script>
 <script src="Scripts/markerclusterer.js" type="text/javascript"></script>
<script>
    /*var map = null;*/

        google.maps.event.addDomListener(window, 'load', initialize);

        function initialize() {
            var mapOptions = {
                zoom: 4,
                center: new google.maps.LatLng(51.333333, 12.383333),
                mapTypeId: google.maps.MapTypeId.ROADMAP
            };
            map = new google.maps.Map(document.getElementById('map_canvas'), mapOptions);

            var image = "Content/themes/base/images/airport2.png";
            var infoWindow = new google.maps.InfoWindow();
            var mcOptions = { gridSize: 40, maxZoom: 15 };
            var markers = [];
            
            @foreach (var airport in Model)
	        {
                var culture = System.Globalization.CultureInfo.InvariantCulture;
                <text>
                    // Creating a marker and putting it on the map
                    var marker = new google.maps.Marker({
                        position: new google.maps.LatLng(@airport.Lat.ToString(culture), @airport.Lng.ToString(culture)),
                        icon: image,
                        map: map,
                        title: "@airport.Name"
                    });
                    markers.push(marker);

                    //Attaching a click event to the current marker
                    (function (marker) {
                        google.maps.event.addListener(marker, "click", function (e) {
                            infoWindow.setContent("@airport.Name");
                            infoWindow.open(map, marker);
                        });
                    })(marker);
                </text>
	        }

            var mc = new MarkerClusterer(map, markers, mcOptions);
        }
 </script>
 <div id="map_canvas" style="width:100%; height:500px"></div> 